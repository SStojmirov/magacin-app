<!DOCTYPE html>
<html lang="mk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ú–∞–≥–∞—Ü–∏–Ω</title>
<style>
  body { margin:0; font-family: Arial, sans-serif; height:100vh; display:flex; justify-content:center; align-items:center; background: linear-gradient(135deg,#1f1f1f,#333); }
  #login-card, #dashboard, .tab { display:none; background:#fff; border-radius:12px; padding:30px; box-shadow:0 8px 20px rgba(0,0,0,0.3); width:350px; text-align:center; max-height:90vh; overflow:auto; }
  input, button, select { width:100%; padding:10px; margin:5px 0; border-radius:6px; font-size:16px; }
  button { border:none; background:#007BFF; color:#fff; cursor:pointer; }
  button:hover { background:#0056b3; }
  h2{text-align:center;}
  .menu button { width:90%; margin:8px 0; }
  .back-btn { background:#555; }
  #lista, #vnesLista, #izlezLista, #oczekDiv, #kontrolaLista { margin-top:10px; }
  #lista div, #vnesLista div, #izlezLista div, #oczekDiv div, #kontrolaLista div { padding:5px; border:1px solid #ddd; margin:3px 0; border-radius:5px; text-align:left; }
</style>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, deleteDoc, doc, updateDoc, query, where, orderBy } 
  from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

// Firebase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—ò–∞
const firebaseConfig = {
  apiKey: "–¢–í–û–à_API_KEY",
  authDomain: "–¢–í–û–à_PROJECT_ID.firebaseapp.com",
  projectId: "–¢–í–û–à_PROJECT_ID",
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// –õ–æ–∑–∏–Ω–∫–∞
const password = "1234";
const loginCard = document.getElementById("login-card");
const dashboard = document.getElementById("dashboard");

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ª–æ–∑–∏–Ω–∫–∞ –≤–æ localStorage
window.addEventListener("load", ()=>{
  if(localStorage.getItem("magacin_pass")===password){
    showDashboard();
  } else {
    loginCard.style.display="block";
  }
});

// Login
function checkLogin(){
  const input = document.getElementById("pass").value;
  if(input===password){
    localStorage.setItem("magacin_pass",password);
    showDashboard();
  } else { alert("–ù–µ—Ç–æ—á–Ω–∞ –ª–æ–∑–∏–Ω–∫–∞!"); }
}
window.checkLogin=checkLogin;

// –ü—Ä–∏–∫–∞–∂–∏ Dashboard
function showDashboard(){
  loginCard.style.display="none";
  dashboard.style.display="block";
  hideTabs();
}

// –¢–∞–±–æ–≤–∏
function hideTabs(){ document.querySelectorAll(".tab").forEach(t=>t.style.display="none"); }
function showTab(id){ hideTabs(); document.getElementById(id).style.display="block"; }
window.showTab=showTab;

// Logout
function logout(){ localStorage.removeItem("magacin_pass"); location.reload(); }
window.logout=logout;

// –í–Ω–µ—Å –Ω–∞ –∞—Ä—Ç–∏–∫–ª–∏
async function dodadiArtikl(e,kolekcija,showDiv){
  e.preventDefault();
  const ime = e.target.ime.value;
  const kolicina = parseFloat(e.target.kolicina.value);
  const merka = e.target.merka.value;
  const cena = parseFloat(e.target.cena.value);
  const datum = new Date();
  const docRef = await addDoc(collection(db,kolekcija),{ime,kolicina,merka,cena,datum});
  e.target.reset();
  prikaziArtikli(showDiv,kolekcija,docRef.id);
}
window.dodadiArtikl=dodadiArtikl;

// –ü—Ä–∏–∫–∞–∂–∏ –∞—Ä—Ç–∏–∫–ª–∏
async function prikaziArtikli(divID,kolekcija,lastId=null){
  const div = document.getElementById(divID);
  div.innerHTML="";
  const snap = await getDocs(collection(db,kolekcija));
  snap.forEach(docu=>{
    const data = docu.data();
    if(lastId){ // –∞–∫–æ –∏–º–∞ lastId, –ø—Ä–∏–∫–∞–∂—É–≤–∞ —Å–∞–º–æ –ø–æ—Å–ª–µ–¥–Ω–∏–æ—Ç –≤–Ω–µ—Å
      if(docu.id===lastId){
        div.innerHTML=`<div><b>${data.ime}</b> ‚Äì ${data.kolicina} ${data.merka} (${data.cena}$)</div>`;
      }
    } else { // –ø—Ä–∏–∫–∞–∂—É–≤–∞ —Å√®
      div.innerHTML+=`<div><b>${data.ime}</b> ‚Äì ${data.kolicina} ${data.merka} (${data.cena}$)</div>`;
    }
  });
}

// –ò–∑–ª–µ–∑ –Ω–∞ –∞—Ä—Ç–∏–∫–ª–∏
async function izlezArtikl(e){
  e.preventDefault();
  const ime = e.target.ime.value;
  const kolicina = parseFloat(e.target.kolicina.value);
  const snap = await getDocs(collection(db,"artikli"));
  snap.forEach(async docu=>{
    const data = docu.data();
    if(data.ime===ime){
      const newKolicina = Math.max(0,data.kolicina - kolicina);
      await updateDoc(doc(db,"artikli",docu.id),{kolicina:newKolicina});
    }
  });
  e.target.reset();
  prikaziArtikli("lista","artikli");
}
window.izlezArtikl=izlezArtikl;

// –ö–æ–Ω—Ç—Ä–æ–ª–∞ –Ω–∞ –≤–Ω–µ—Å –ø–æ –¥–∞—Ç—É–º
async function kontrolaVnes(startDate,endDate){
  const div = document.getElementById("kontrolaLista");
  div.innerHTML="";
  const snap = await getDocs(collection(db,"artikli"));
  snap.forEach(docu=>{
    const data = docu.data();
    const datum = data.datum.toDate ? data.datum.toDate() : new Date(data.datum);
    if(datum>=startDate && datum<=endDate){
      div.innerHTML+=`<div><b>${data.ime}</b> ‚Äì ${data.kolicina} ${data.merka} (${data.cena}$) - ${datum.toLocaleString()}</div>`;
    }
  });
}
window.kontrolaVnes=kontrolaVnes;
</script>
</head>
<body>

<!-- Login -->
<div id="login-card">
  <h2>üîí –í–Ω–µ—Å–∏ –ª–æ–∑–∏–Ω–∫–∞</h2>
  <input type="password" id="pass" placeholder="–õ–æ–∑–∏–Ω–∫–∞">
  <button onclick="checkLogin()">–í–ª–µ–∑–∏</button>
</div>

<!-- Dashboard -->
<div id="dashboard">
  <h2>üìã –ì–ª–∞–≤–Ω–æ –º–µ–Ω–∏</h2>
  <div class="menu">
    <button onclick="showTab('tabVnes')">–í–Ω–µ—Å –Ω–∞ –∞—Ä—Ç–∏–∫–ª–∏</button>
    <button onclick="showTab('tabIzlez')">–ò–∑–ª–µ–∑ –Ω–∞ –∞—Ä—Ç–∏–∫–ª–∏</button>
    <button onclick="showTab('tabIzvestaj')">–ò–∑–≤–µ—à—Ç–∞—ò (–º–æ–º–µ–Ω—Ç–∞–ª–Ω–∞ —Å–æ—Å—Ç–æ—ò–±–∞)</button>
    <button onclick="showTab('tabOcekuvano')">–û—á–µ–∫—É–≤–∞–Ω–æ / –ù–∞—Ä–∞—á–∞–Ω–æ</button>
    <button onclick="showTab('tabKontrola')">–ö–æ–Ω—Ç—Ä–æ–ª–∞ –Ω–∞ –≤–Ω–µ—Å</button>
    <button class="back-btn" onclick="logout()">Logout</button>
  </div>
</div>

<!-- –í–Ω–µ—Å –Ω–∞ –∞—Ä—Ç–∏–∫–ª–∏ -->
<div class="tab" id="tabVnes">
  <h2>‚ûï –í–Ω–µ—Å –Ω–∞ –∞—Ä—Ç–∏–∫–ª–∏</h2>
  <form onsubmit="dodadiArtikl(event,'artikli','vnesLista')">
    <input name="ime" placeholder="–ò–º–µ –Ω–∞ –∞—Ä—Ç–∏–∫–ª" required>
    <input name="kolicina" type="number" placeholder="–ö–æ–ª–∏—á–∏–Ω–∞" required>
    <input name="merka" placeholder="–ú–µ—Ä–∫–∞ (–ø–∞—Ä—á–µ, –∫–≥...)" required>
    <input name="cena" type="number" step="0.01" placeholder="–¶–µ–Ω–∞" required>
    <button type="submit">–î–æ–¥–∞—ò</button>
  </form>
  <div id="vnesLista"></div>
</div>

<!-- –ò–∑–ª–µ–∑ –Ω–∞ –∞—Ä—Ç–∏–∫–ª–∏ -->
<div class="tab" id="tabIzlez">
  <h2>‚ûñ –ò–∑–ª–µ–∑ –Ω–∞ –∞—Ä—Ç–∏–∫–ª–∏</h2>
  <form onsubmit="izlez
