<!DOCTYPE html>
<html lang="mk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ú–∞–≥–∞—Ü–∏–Ω</title>
<style>
  body { margin:0; font-family: Arial, sans-serif; height:100vh; display:flex; justify-content:center; align-items:center; background: linear-gradient(135deg,#1f1f1f,#333); }
  #login-card, #dashboard, .tab { display:none; background:#fff; border-radius:12px; padding:30px; box-shadow:0 8px 20px rgba(0,0,0,0.3); width:320px; text-align:center; }
  #login-card input { width:100%; padding:10px; margin:10px 0; border-radius:6px; border:1px solid #ccc; }
  #login-card button, .tab button, .menu button { width:100%; padding:10px; margin:5px 0; border:none; border-radius:6px; background:#007BFF; color:#fff; font-size:16px; cursor:pointer; }
  #login-card button:hover, .tab button:hover, .menu button:hover { background:#0056b3; }
  h2{text-align:center;}
  #lista div { margin:5px; padding:5px; border:1px solid #ddd; }
  .menu button { width:90%; margin:8px 0; }
  .back-btn { background:#555; }
</style>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, deleteDoc, doc, updateDoc } 
  from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

// üëá Firebase –ø–æ–¥–∞—Ç–æ—Ü–∏
const firebaseConfig = {
  apiKey: "AIzaSyAbCqqSwKQ62Q38K-DM15jsZQePloDD8XM",
  authDomain: "magacinapp-6a8f5.firebaseapp.com",
  projectId: "magacinapp-6a8f5",
  storageBucket: "magacinapp-6a8f5.firebasestorage.app",
  messagingSenderId: "160054879907",
  appId: "1:160054879907:web:ded639dcd0a9e0a64e4116"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// –õ–æ–∑–∏–Ω–∫–∞
const password = "1234";
const loginCard = document.getElementById("login-card");
const dashboard = document.getElementById("dashboard");

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ª–æ–∑–∏–Ω–∫–∞ –≤–æ localStorage
window.addEventListener("load", ()=>{
  if(localStorage.getItem("magacin_pass") === password){
    showDashboard();
  } else {
    loginCard.style.display = "block";
  }
});

// Login
function checkLogin(){
  const input = document.getElementById("pass").value;
  if(input===password){
    localStorage.setItem("magacin_pass",password);
    showDashboard();
  } else { alert("–ù–µ—Ç–æ—á–Ω–∞ –ª–æ–∑–∏–Ω–∫–∞!"); }
}
window.checkLogin=checkLogin;

// –ü—Ä–∏–∫–∞–∂–∏ Dashboard
function showDashboard(){
  loginCard.style.display="none";
  dashboard.style.display="block";
  hideTabs();
}

// –§—É–Ω–∫—Ü–∏–∏ –∑–∞ —Ç–∞–±–æ–≤–∏
function hideTabs(){ document.querySelectorAll(".tab").forEach(t=>t.style.display="none"); }
function showTab(id){ hideTabs(); document.getElementById(id).style.display="block"; }
window.showTab=showTab;

// Logout
function logout(){ localStorage.removeItem("magacin_pass"); location.reload(); }
window.logout=logout;

// Firebase —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞ –º–∞–≥–∞—Ü–∏–Ω
async function prikaziArtikli(divID, kolekcija){
  const div = document.getElementById(divID);
  div.innerHTML="";
  const querySnapshot = await getDocs(collection(db,kolekcija));
  querySnapshot.forEach(docu=>{
    const data = docu.data();
    div.innerHTML+=`<div><b>${data.ime}</b> ‚Äì ${data.kolicina} ${data.merka} (${data.cena}$) 
      ${kolekcija!=="oczekuvano"?`<button onclick="izbrisi('${docu.id}','${kolekcija}')">–ò–∑–±—Ä–∏—à–∏</button>`:""}
    </div>`;
  });
}

// –î–æ–¥–∞–≤–∞—ö–µ –∞—Ä—Ç–∏–∫–ª
async function dodadiArtikl(e,kolekcija){
  e.preventDefault();
  const ime = e.target.ime.value;
  const kolicina = parseFloat(e.target.kolicina.value);
  const merka = e.target.merka.value;
  const cena = parseFloat(e.target.cena.value);
  await addDoc(collection(db,kolekcija),{ime,kolicina,merka,cena});
  e.target.reset();
  prikaziArtikli(kolekcija==="artikli"?"lista":"oczekDiv",kolekcija);
}
window.dodadiArtikl=dodadiArtikl;

// –ò–∑–±—Ä–∏—à–∏ –∞—Ä—Ç–∏–∫–ª
async function izbrisi(id,kolekcija){
  await deleteDoc(doc(db,kolekcija,id));
  prikaziArtikli(kolekcija==="artikli"?"lista":"oczekDiv",kolekcija);
}
window.izbrisi=izbrisi;

// –ò–∑–ª–µ–∑ –Ω–∞ –∞—Ä—Ç–∏–∫–ª
async function izlezArtikl(e){
  e.preventDefault();
  const ime = e.target.ime.value;
  const kolicina = parseFloat(e.target.kolicina.value);
  const snap = await getDocs(collection(db,"artikli"));
  snap.forEach(async docu=>{
    const data = docu.data();
    if(data.ime===ime){
      const newKolicina = Math.max(0,data.kolicina - kolicina);
      await updateDoc(doc(db,"artikli",docu.id),{kolicina:newKolicina});
    }
  });
  e.target.reset();
  prikaziArtikli("lista","artikli");
}
window.izlezArtikl=izlezArtikl;
</script>
</head>
<body>

<!-- Login -->
<div id="login-card">
  <h2>üîí –í–Ω–µ—Å–∏ –ª–æ–∑–∏–Ω–∫–∞</h2>
  <input type="password" id="pass" placeholder="–õ–æ–∑–∏–Ω–∫–∞">
  <button onclick="checkLogin()">–í–ª–µ–∑–∏</button>
</div>

<!-- Dashboard -->
<div id="dashboard">
  <h2>üìã –ì–ª–∞–≤–Ω–æ –º–µ–Ω–∏</h2>
  <div class="menu">
    <button onclick="showTab('tabVnes')">–í–Ω–µ—Å –Ω–∞ –∞—Ä—Ç–∏–∫–ª–∏</button>
    <button onclick="showTab('tabIzlez')">–ò–∑–ª–µ–∑ –Ω–∞ –∞—Ä—Ç–∏–∫–ª–∏</button>
    <button onclick="showTab('tabIzvestaj')">–ò–∑–≤–µ—à—Ç–∞—ò (–º–æ–º–µ–Ω—Ç–∞–ª–Ω–∞ —Å–æ—Å—Ç–æ—ò–±–∞)</button>
    <button onclick="showTab('tabOcekuvano')">–û—á–µ–∫—É–≤–∞–Ω–æ / –ù–∞—Ä–∞—á–∞–Ω–æ</button>
    <button class="back-btn" onclick="logout()">Logout</button>
  </div>
</div>

<!-- –í–Ω–µ—Å –Ω–∞ –∞—Ä—Ç–∏–∫–ª–∏ -->
<div class="tab" id="tabVnes">
  <h2>‚ûï –í–Ω–µ—Å –Ω–∞ –∞—Ä—Ç–∏–∫–ª–∏</h2>
  <form onsubmit="dodadiArtikl(event,'artikli')" id="form">
    <input name="ime" placeholder="–ò–º–µ –Ω–∞ –∞—Ä—Ç–∏–∫–ª" required>
    <input name="kolicina" type="number" placeholder="–ö–æ–ª–∏—á–∏–Ω–∞" required>
    <input name="merka" placeholder="–ú–µ—Ä–∫–∞ (–ø–∞—Ä—á–µ, –∫–≥...)" required>
    <input name="cena" type="number" step="0.01" placeholder="–¶–µ–Ω–∞" required>
    <button type="submit">–î–æ–¥–∞—ò</button>
  </form>
  <div id="lista"></div>
</div>

<!-- –ò–∑–ª–µ–∑ –Ω–∞ –∞—Ä—Ç–∏–∫–ª–∏ -->
<div class="tab" id="tabIzlez">
  <h2>‚ûñ –ò–∑–ª–µ–∑ –Ω–∞ –∞—Ä—Ç–∏–∫–ª–∏</h2>
  <form onsubmit="izlezArtikl(event)">
    <input name="ime" placeholder="–ò–º–µ –Ω–∞ –∞—Ä—Ç–∏–∫–ª" required>
    <input name="kolicina" type="number" placeholder="–ö–æ–ª–∏—á–∏–Ω–∞" required>
    <button type="submit">–ò–∑–ª–µ–∑</button>
  </form>
</div>

<!-- –ò–∑–≤–µ—à—Ç–∞—ò -->
<div class="tab" id="tabIzvestaj">
  <h2>üìä –ú–æ–º–µ–Ω—Ç–∞–ª–Ω–∞ —Å–æ—Å—Ç–æ—ò–±–∞</h2>
  <div id="lista"></div>
  <button onclick="prikaziArtikli('lista','artikli')">–û–±–Ω–æ–≤–∏</button>
</div>

<!-- –û—á–µ–∫—É–≤–∞–Ω–æ / –Ω–∞—Ä–∞—á–∞–Ω–æ -->
<div class="tab" id="tabOcekuvano">
  <h2>üìù –û—á–µ–∫—É–≤–∞–Ω–æ / –ù–∞—Ä–∞—á–∞–Ω–æ</h2>
  <form onsubmit="dodadiArtikl(event,'oczekuvano')">
    <input name="ime" placeholder="–ò–º–µ –Ω–∞ –∞—Ä—Ç–∏–∫–ª" required>
    <input name="kolicina" type="number" placeholder="–ö–æ–ª–∏—á–∏–Ω–∞" required>
    <input name="merka" placeholder="–ú–µ—Ä–∫–∞" required>
    <input name="cena" type="number" step="0.01" placeholder="–¶–µ–Ω–∞" required>
    <button type="submit">–î–æ–¥–∞—ò</button>
  </form>
  <div id="oczekDiv"></div>
</div>

</body>
</html>
