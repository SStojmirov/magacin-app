<!DOCTYPE html>
<html lang="mk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ú–∞–≥–∞—Ü–∏–Ω</title>
<style>
body { margin:0; font-family: Arial, sans-serif; background: linear-gradient(135deg,#1f1f1f,#333); display:flex; justify-content:center; align-items:center; min-height:100vh; }
#login-card, #dashboard, .tab { display:none; background:#fff; border-radius:12px; padding:30px; box-shadow:0 8px 20px rgba(0,0,0,0.3); width:360px; text-align:center; max-height:90vh; overflow:auto; }
input, button, select { width:100%; padding:10px; margin:5px 0; border-radius:6px; font-size:16px; }
button { border:none; background:#007BFF; color:#fff; cursor:pointer; }
button:hover { background:#0056b3; }
h2{text-align:center;}
.menu button { width:90%; margin:8px 0; }
.back-btn { background:#555; }
#vnesLista, #izlezLista, #lista, #oczekDiv, #kontrolaLista { margin-top:10px; }
#vnesLista div, #izlezLista div, #lista div, #oczekDiv div, #kontrolaLista div { padding:5px; border:1px solid #ddd; margin:3px 0; border-radius:5px; text-align:left; }
</style>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, doc, updateDoc, query, where, orderBy } 
from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

// üîπ Firebase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—ò–∞
const firebaseConfig = {
  apiKey: "AIzaSyAbCqqSwKQ62Q38K-DM15jsZQePloDD8XM",
  authDomain: "magacinapp-6a8f5.firebaseapp.com",
  projectId: "magacinapp-6a8f5",
  storageBucket: "magacinapp-6a8f5.firebasestorage.app",
  messagingSenderId: "160054879907",
  appId: "1:160054879907:web:ded639dcd0a9e0a64e4116"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// –õ–æ–∑–∏–Ω–∫–∞
const password = "1234";
const loginCard = document.getElementById("login-card");
const dashboard = document.getElementById("dashboard");

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ª–æ–∑–∏–Ω–∫–∞
window.addEventListener("load", ()=>{
  if(localStorage.getItem("magacin_pass")===password){ showDashboard(); } 
  else { loginCard.style.display="block"; }
});

function checkLogin(){
  const input = document.getElementById("pass").value;
  if(input===password){ localStorage.setItem("magacin_pass",password); showDashboard(); } 
  else { alert("–ù–µ—Ç–æ—á–Ω–∞ –ª–æ–∑–∏–Ω–∫–∞!"); }
}
window.checkLogin=checkLogin;

function showDashboard(){ loginCard.style.display="none"; dashboard.style.display="block"; hideTabs(); }
function hideTabs(){ document.querySelectorAll(".tab").forEach(t=>t.style.display="none"); }
function showTab(id){ hideTabs(); document.getElementById(id).style.display="block"; }
window.showTab=showTab;

function logout(){ localStorage.removeItem("magacin_pass"); location.reload(); }
window.logout=logout;

// üîπ –í–Ω–µ—Å —Å–æ dropdown
async function loadArtikliDropdown(){
  const select = document.getElementById("artiklSelect");
  select.innerHTML="";
  const snap = await getDocs(collection(db,"artikli"));
  snap.forEach(docu=>{
    const data = docu.data();
    const option = document.createElement("option");
    option.value=docu.id;
    option.text=`${data.ime} (${data.merka})`;
    option.dataset.merka=data.merka;
    select.appendChild(option);
  });
}
window.loadArtikliDropdown=loadArtikliDropdown;

async function dodadiMagacin(e){
  e.preventDefault();
  const select = document.getElementById("artiklSelect");
  const docId = select.value;
  const ime = select.options[select.selectedIndex].text.split(" (")[0];
  const merka = select.options[select.selectedIndex].dataset.merka;
  const kolicina = parseFloat(document.getElementById("vnesKolicina").value);
  const datum = new Date();
  await addDoc(collection(db,"magacin"),{ime,kolicina,merka,datum});
  document.getElementById("vnesKolicina").value="";
  prikaziArtikli("vnesLista","magacin",true);
}
window.dodadiMagacin=dodadiMagacin;

// –ü—Ä–∏–∫–∞–∂–∏ –∞—Ä—Ç–∏–∫–ª–∏
async function prikaziArtikli(divID,kolekcija,onlyLast=false){
  const div = document.getElementById(divID);
  div.innerHTML="";
  const snap = await getDocs(collection(db,kolekcija));
  snap.forEach(docu=>{
    const data = docu.data();
    if(onlyLast){
      div.innerHTML=`<div><b>${data.ime}</b> ‚Äì ${data.kolicina} ${data.merka}</div>`;
    } else { div.innerHTML+=`<div><b>${data.ime}</b> ‚Äì ${data.kolicina} ${data.merka}</div>`; }
  });
}

// üîπ –ö–æ–Ω—Ç—Ä–æ–ª–∞ –ø–æ –¥–∞—Ç—É–º
async function kontrolaVnes(startStr,endStr){
  const div = document.getElementById("kontrolaLista");
  div.innerHTML="";
  const snap = await getDocs(collection(db,"magacin"));
  const startDate = new Date(startStr);
  const endDate = new Date(endStr); endDate.setHours(23,59,59);
  snap.forEach(docu=>{
    const data = docu.data();
    const datum = data.datum.toDate ? data.datum.toDate() : new Date(data.datum);
    if(datum>=startDate && datum<=endDate){
      div.innerHTML+=`<div><b>${data.ime}</b> ‚Äì ${data.kolicina} ${data.merka} - ${datum.toLocaleString()}</div>`;
    }
  });
}
window.kontrolaVnes=kontrolaVnes;
</script>
</head>
<body>

<!-- Login -->
<div id="login-card">
<h2>üîí –í–Ω–µ—Å–∏ –ª–æ–∑–∏–Ω–∫–∞</h2>
<input type="password" id="pass" placeholder="–õ–æ–∑–∏–Ω–∫–∞">
<button onclick="checkLogin()">–í–ª–µ–∑–∏</button>
</div>

<!-- Dashboard -->
<div id="dashboard">
<h2>üìã –ì–ª–∞–≤–Ω–æ –º–µ–Ω–∏</h2>
<div class="menu">
<button onclick="showTab('tabVnes'); loadArtikliDropdown()">–í–Ω–µ—Å –Ω–∞ –∞—Ä—Ç–∏–∫–ª–∏</button>
<button onclick="showTab('tabIzlez')">–ò–∑–ª–µ–∑ –Ω–∞ –∞—Ä—Ç–∏–∫–ª–∏</button>
<button onclick="showTab('tabIzvestaj')">–ò–∑–≤–µ—à—Ç–∞—ò (–º–æ–º–µ–Ω—Ç–∞–ª–Ω–∞ —Å–æ—Å—Ç–æ—ò–±–∞)</button>
<button onclick="showTab('tabOcekuvano')">–û—á–µ–∫—É–≤–∞–Ω–æ / –ù–∞—Ä–∞—á–∞–Ω–æ</button>
<button onclick="showTab('tabKontrola')">–ö–æ–Ω—Ç—Ä–æ–ª–∞ –Ω–∞ –≤–Ω–µ—Å</button>
<button class="back-btn" onclick="logout()">Logout</button>
</div>
</div>

<!-- –í–Ω–µ—Å –Ω–∞ –∞—Ä—Ç–∏–∫–ª–∏ -->
<div class="tab" id="tabVnes">
<h2>‚ûï –í–Ω–µ—Å –Ω–∞ –∞—Ä—Ç–∏–∫–ª–∏</h2>
<form onsubmit="dodadiMagacin(event)">
<select id="artiklSelect" required></select>
<input type="number" id="vnesKolicina" placeholder="–ö–æ–ª–∏—á–∏–Ω–∞" required>
<button type="submit">–î–æ–¥–∞—ò</button>
</form>
<div id="vnesLista"></div>
</div>

<!-- –ò–∑–≤–µ—à—Ç–∞—ò -->
<div class="tab" id="tabIzvestaj">
<h2>üìä –ú–æ–º–µ–Ω—Ç–∞–ª–Ω–∞ —Å–æ—Å—Ç–æ—ò–±–∞</h2>
<div id="lista"></div>
<button onclick="prikaziArtikli('lista','magacin')">–û–±–Ω–æ–≤–∏</button>
</div>

<!-- –ö–æ–Ω—Ç—Ä–æ–ª–∞ –Ω–∞ –≤–Ω–µ—Å -->
<div class="tab" id="tabKontrola">
<h2>üìù –ö–æ–Ω—Ç—Ä–æ–ª–∞ –Ω–∞ –≤–Ω–µ—Å</h2>
<label>–û–¥: <input type="date" id="startDate"></label>
<label>–î–æ: <input type="date" id="endDate"></label>
<button onclick="kontrolaVnes(document.getElementById('startDate').value, document.getElementById('endDate').value)">–ü—Ä–∏–∫–∞–∂–∏</button>
<div id="kontrolaLista"></div>
</div>

<!-- –û—á–µ–∫—É–≤–∞–Ω–æ / –ù–∞—Ä–∞—á–∞–Ω–æ -->
<div class="tab" id="tabOcekuvano">
<h2>üìù –û—á–µ–∫—É–≤–∞–Ω–æ / –ù–∞—Ä–∞—á–∞–Ω–æ</h2>
<form onsubmit="dodadiArtikl(event,'oczekuvano','oczekDiv')">
<input name="ime" placeholder="–ò–º–µ –Ω–∞ –∞—Ä—Ç–∏–∫–ª" required>
<input name="kolicina" type="number" placeholder="–ö–æ–ª–∏—á–∏–Ω–∞" required>
<input name="merka" placeholder="–ú–µ—Ä–∫–∞" required>
<input name="cena" type="number" step="0.01" placeholder="–¶–µ–Ω–∞" required>
<button type="submit">–î–æ–¥–∞—ò</button>
</form>
<div id="oczekDiv"></div>
</div>

</body>
</html>
